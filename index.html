<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CS2 Economy Helper</title>
  <style>
    .money-buttons button {
      margin-right: 5px;
    }
    .memory-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h2>CS2 Economy Decision Helper</h2>

  <!-- === User Input Form Section === -->
  <form id="econ-form">
    <!-- Team Side Input -->
    <label>Which side are you playing?
      <select name="side" id="side" onchange="toggleBombPlanted()">
        <option value="T">Terrorist (T)</option>
        <option value="CT">Counter-Terrorist (CT)</option>
      </select>
    </label>
    <br/><br/>

    <!-- Score Input Instead of Round/Match Point -->
    <label>Current score:
      CT <input type="number" id="ct_score" name="ct_score" value="0" min="0" max="15" />
      T <input type="number" id="t_score" name="t_score" value="0" min="0" max="15" />
    </label>
    <br/><br/>

    <!-- Money Input and Buttons -->
    <label>Current money:
      <input type="number" name="money" id="money" value="2500" />
    </label>
    <div class="money-buttons">
      <button type="button" onclick="adjustMoney(200)">+200</button>
      <button type="button" onclick="adjustMoney(500)">+500</button>
      <button type="button" onclick="adjustMoney(1000)">+1000</button>
      <button type="button" onclick="setMoney(0)">Reset</button>
      <button type="button" onclick="setMoney(16000)">Max</button>
    </div>
    <br/><br/>

    <!-- Loss Streak Input -->
    <label>How many rounds in a row have you lost?
      <select name="loss_streak" id="loss_streak">
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 or more</option>
      </select>
    </label>
    <br/><br/>

    <!-- Game Conditions -->
    <label id="bomb-label">Did your team plant the bomb last round (T side)?
      <input type="checkbox" name="bomb_planted" id="bomb_planted" />
    </label>
    <br/><br/>

    <label>Did you save a weapon from the last round?
      <input type="checkbox" name="saved_weapon" id="saved_weapon" />
    </label>
    <br/><br/>

    <!-- Enemy Round Result -->
    <label>How did the enemy win their last round?
      <select name="enemy_recent_win_type" id="enemy_recent_win_type">
        <option value="unknown">Not sure</option>
        <option value="clean">Clean Win (4-5 survived)</option>
        <option value="close">Close Win (1-2 survived)</option>
        <option value="eco">Eco/Force Buy Win</option>
      </select>
    </label>
    <br/><br/>

    <!-- Input Reuse Toggle -->
    <div class="memory-controls">
      <label for="reuse_last">Remember my last inputs</label>
      <input type="checkbox" id="reuse_last" checked />
      <button type="button" onclick="clearMemory()">Clear Memory</button>
    </div>
    <br/><br/>

    <!-- Submit Button -->
    <button type="submit">Get Buy Suggestion</button>
  </form>

  <!-- === Output Display Section === -->
  <div id="result"></div>

  <!-- === Logic & Script Section === -->
  <script>
    const memory = {};

    function adjustMoney(amount) {
      const moneyField = document.getElementById('money');
      moneyField.value = parseInt(moneyField.value || 0) + amount;
    }

    function setMoney(amount) {
      document.getElementById('money').value = amount;
    }

    function toggleBombPlanted() {
      const side = document.getElementById('side').value;
      const bombLabel = document.getElementById('bomb-label');
      bombLabel.style.display = (side === 'T') ? 'block' : 'none';
    }

    function saveState() {
      memory.side = document.getElementById('side').value;
      memory.loss_streak = document.getElementById('loss_streak').value;
      memory.bomb_planted = document.getElementById('bomb_planted').checked;
      memory.saved_weapon = document.getElementById('saved_weapon').checked;
      memory.enemy_recent_win_type = document.getElementById('enemy_recent_win_type').value;
      memory.ct_score = document.getElementById('ct_score').value;
      memory.t_score = document.getElementById('t_score').value;
    }

    function loadState() {
      if (!document.getElementById('reuse_last').checked) return;

      if (memory.side) document.getElementById('side').value = memory.side;
      if (memory.loss_streak) document.getElementById('loss_streak').value = memory.loss_streak;
      document.getElementById('bomb_planted').checked = memory.bomb_planted || false;
      document.getElementById('saved_weapon').checked = memory.saved_weapon || false;

      if (memory.enemy_recent_win_type) {
        document.getElementById('enemy_recent_win_type').value = memory.enemy_recent_win_type;
      }

      if (memory.ct_score) document.getElementById('ct_score').value = memory.ct_score;
      if (memory.t_score) document.getElementById('t_score').value = memory.t_score;

      toggleBombPlanted();
    }

    function clearMemory() {
      for (let key in memory) {
        delete memory[key];
      }
      alert("Saved inputs have been cleared.");
    }

    function suggestBuy(data) {
      const loadout = [];
      let strategy = 'Full Buy';
      let projectedMoney = 0;

      const fullBuyThreshold = 4700;
      const halfBuyThreshold = 2500;

      const fullBuyItems = ["Rifle (AK/M4)", "Kevlar + Helmet", "Full Utility"];
      const halfBuyItems = ["SMG / Deagle", "Kevlar"];
      const ecoItems = ["Glock / USP", "Save for next"];

      const totalRounds = data.ct_score + data.t_score;
      const match_point = data.ct_score === 15 || data.t_score === 15;
      const end_of_half = totalRounds >= 15;

      if (data.money >= fullBuyThreshold || match_point) {
        strategy = 'Full Buy';
        loadout.push(...fullBuyItems);
      } else if (
        (data.money >= halfBuyThreshold && data.loss_streak >= 2) ||
        (data.bomb_planted && data.side === 'T') ||
        data.saved_weapon ||
        data.enemy_recent_win_type === 'close'
      ) {
        strategy = 'Force Buy';
        loadout.push(...halfBuyItems);
      } else {
        strategy = 'Eco';
        loadout.push(...ecoItems);
      }

      let estimatedSpend = 0;
      if (strategy === 'Full Buy') estimatedSpend = 4700;
      else if (strategy === 'Force Buy') estimatedSpend = 2500;

      let remainingMoney = data.money - estimatedSpend;
      if (remainingMoney < 0) remainingMoney = 0;

      let baseLoss = 1400 + 500 * data.loss_streak;
      if (data.loss_streak >= 5) baseLoss = 3400;
      if (data.bomb_planted && data.side === 'T') baseLoss += 800;

      projectedMoney = remainingMoney + baseLoss;

      return {
        strategy: strategy,
        recommended_loadout: loadout,
        projected_next_round_money: projectedMoney
      };
    }

    document.getElementById('econ-form').addEventListener('submit', function (e) {
      e.preventDefault();

      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());

      data.money = parseInt(data.money);
      data.loss_streak = parseInt(data.loss_streak);
      data.bomb_planted = formData.get("bomb_planted") === 'on';
      data.saved_weapon = formData.get("saved_weapon") === 'on';
      data.ct_score = parseInt(data.ct_score);
      data.t_score = parseInt(data.t_score);

      saveState();

      const result = suggestBuy(data);

      const output = `
        <h3>Buy Suggestion</h3>
        <p><strong>Strategy:</strong> ${result.strategy}</p>
        <p><strong>Loadout:</strong><br/> - ${result.recommended_loadout.join('<br/> - ')}</p>
        <p><strong>Projected Next Round $:</strong> ${result.projected_next_round_money}</p>
      `;

      document.getElementById('result').innerHTML = output;
    });

    window.onload = loadState;
  </script>
</body>
</html>
